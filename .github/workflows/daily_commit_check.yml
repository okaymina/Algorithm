name: Daily Commit Check

on:
  schedule:
    - cron: '0 0 * * *' # ë§¤ì¼ 9ì‹œ (KST)
  workflow_dispatch:

jobs:
  commit-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Check yesterday's commits
        run: |
          YESTERDAY=$(date -d "yesterday" '+%Y-%m-%d')
          TODAY=$(date '+%Y-%m-%d')
          COMMITS=$(git log --since="$YESTERDAYT00:00:00" --until="$TODAYT00:00:00" --pretty=format:"%h - %s")

          echo "COMMITS<<EOF" >> $GITHUB_ENV
          echo "$COMMITS" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Add comment to Issue
        uses: peter-evans/create-or-update-comment@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: 1 # ğŸ“Œ Daily Commit Tracker ì´ìŠˆ ë²ˆí˜¸ (1ë²ˆìœ¼ë¡œ ë³´ì„!)
          body: |
            ğŸ“… **${YESTERDAY} ì»¤ë°‹ í™•ì¸ ê²°ê³¼**
            ---
            ${{ env.COMMITS }}

            ${{
              env.COMMITS == '' && 'âŒ ì–´ì œ ì»¤ë°‹ì´ ì—†ì—ˆì–´ìš” ğŸŒ ë°ë¹„í‹°ê°€ ê¸°ë‹¤ë ¸ì–´ìš”!'
              || 'âœ… ì–´ì œë„ ê¾¸ì¤€íˆ ì»¤ë°‹í–ˆë„¤ìš”! ë©‹ì ¸ìš” ğŸ’ª'
            }}
